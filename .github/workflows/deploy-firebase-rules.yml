name: Deploy Firestore & Storage Rules

on:
  push:
    branches:
      - website

jobs:
  deploy-rules:
    name: Deploy Firestore + Storage rules
    runs-on: ubuntu-latest
    steps:
      - name: Checkout repository
        uses: actions/checkout@v4

      - name: Install Firebase CLI
        run: |
          npm ci --silent || true
          npm i -g firebase-tools@latest

      - name: Configure Firebase token
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
        run: |
          if [ -z "$FIREBASE_TOKEN" ]; then
            echo "FIREBASE_TOKEN is not set. Add it as a repo secret named FIREBASE_TOKEN." >&2
            exit 1
          fi

      - name: Deploy rules (firestore + storage)
        env:
          FIREBASE_TOKEN: ${{ secrets.FIREBASE_TOKEN }}
        run: |
          firebase deploy --only firestore:rules,storage:rules --project neuinternshipdb --token "$FIREBASE_TOKEN"
